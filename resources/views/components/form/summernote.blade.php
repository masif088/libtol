<div class="form-group col-span-6 sm:col-span-5" wire:ignore>
    <label for="name">{{$title}}</label>
    <textarea type="text" input="description" id="{{str_replace(".", "", $model)}}"
              class="form-control summernote @error($model) border-danger @enderror"></textarea>
    @error($model) <span class="error text-danger">{{ $message }}</span> @enderror
    <script>
        document.addEventListener('livewire:load', function () {
            $("textarea#{{str_replace('.', '', $model)}}").val(@this.get('{{$model}}'));
            $('#{{str_replace(".", "", $model)}}').summernote({
                dialogsInBody: true,
                tabsize: 2,
                height: 200,

                callbacks: {
                    onImageUpload: function (files) {
                        for (let i = 0; i < files.length; i++) {
                            $.upload(files[i]);
                        }
                        console.log('file loading');
                    },
                    onChange: function (content, $editable) {
                    @this.set('{{$model}}', content)
                    },
                }
            });
            $.upload = function (file) {
                let out = new FormData();
                out.append('file', file, file.name);
                $.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name=csrf-token]').attr('content')
                    }
                });
                $.ajax({
                    method: 'POST',
                    url: '{{route('summernote_upload')}}',
                    contentType: false,
                    cache: false,
                    processData: false,
                    data: out,
                    success: function (img) {
                        image = '<img src="' + window.location.protocol + '//' + window.location.host + '/storage/' + img + '" alt=\"Italian Trulli\">'
                        $("textarea#{{str_replace('.', '', $model)}}").summernote('code', @this.get('{{$model}}') + image);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error(textStatus + " " + errorThrown);
                    }
                });
            };
        });
    </script>
</div>
